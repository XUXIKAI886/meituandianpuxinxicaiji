# 店铺信息提取器

一个基于 Electron 的桌面应用程序，用于从文本文件中智能提取店铺信息并导出到 Excel 文件。

## 功能特性

### 🏪 智能数据提取
- 支持 JSON 格式的店铺信息提取
- 自动解析店铺名称、联系电话、地址、评分等关键信息
- 支持批量处理多条店铺数据
- **智能去重功能**：自动识别并过滤重复店铺信息

### 📊 Excel 导出
- 一键导出提取结果到 Excel 文件
- 支持追加模式，不覆盖现有数据
- 自动生成时间戳和序号
- **去重保护**：避免重复数据录入Excel表格

### 👁️ 实时监控
- 实时监控数据源文件变化
- 文件更新时自动提取新内容
- 自动追加新数据到 Excel 文件
- **固定路径模式**：数据源路径固定为 `D:\ailun\dianpuxinxi.txt`

### 🎨 现代化界面
- 基于 Web 技术栈（HTML、CSS、JavaScript）
- **16种主题方案**：从清新蓝灰到深色主题可选
- **1100x1100固定窗口**：专为呈尚策划客服部定制
- 直观的操作界面和状态反馈

## 系统要求

### 基础环境
- Windows 10/11, macOS 10.14+, 或 Linux
- Python 3.7+ （用于数据提取）
- Node.js 16+ （用于开发和构建）

### 数据采集工具（可选）
- **Fiddler Classic** （用于抓包采集店铺数据）
- 支持HTTPS解密功能
- 微信小程序或浏览器访问美团外卖

## 安装依赖

### 1. 安装 Node.js 依赖
```bash
npm install
```

### 2. 安装 Python 依赖
```bash
pip install pandas openpyxl
```

## 使用方法

### 启动应用
```bash
npm start
```

### 开发模式
```bash
npm run dev
```

### 构建应用
```bash
npm run build
```

## 使用指南

### 1. 数据采集（使用Fiddler抓包）

#### 1.1 安装和配置Fiddler
1. 下载并安装 [Fiddler Classic](https://www.telerik.com/fiddler)
2. 启动Fiddler，配置HTTPS抓包：
   - 点击 `Tools` → `Options` → `HTTPS`
   - 勾选 `Capture HTTPS CONNECTs`
   - 勾选 `Decrypt HTTPS traffic`
   - 安装证书（按提示操作）

#### 1.2 配置自动脚本
1. 在Fiddler中点击 `Rules` → `Customize Rules`
2. 在打开的脚本编辑器中找到 `OnBeforeResponse` 函数
3. 在函数内添加以下脚本代码：

```javascript
// 自动保存美团外卖店铺信息
if(oSession.uriContains("https://wx.waimai.meituan.com/weapp/v1/poi/info?")){
    oSession.utilDecodeResponse();
    oSession.SaveResponse("D:/ailun/dianpuxinxi.txt",true);
    oSession.SaveResponseBody("D:/ailun/dianpuxinxi.txt");
}
```

4. 保存脚本（Ctrl+S）

#### 1.3 开始数据采集
1. 确保 `D:\ailun\` 目录存在
2. 启动Fiddler抓包
3. 在微信小程序中浏览美团外卖店铺
4. Fiddler会自动将店铺信息保存到 `D:\ailun\dianpuxinxi.txt`

### 2. 准备数据源
- **自动模式**：使用Fiddler脚本自动采集数据到 `D:\ailun\dianpuxinxi.txt`
- **手动模式**：手动将店铺信息文件放置到 `D:\ailun\dianpuxinxi.txt`
- 支持 JSON 格式的数据文件（单行或多行JSON）
- 确保文件编码为 UTF-8

### 3. 设置输出文件
- 点击"选择保存位置"按钮设置 Excel 输出文件路径
- 建议使用 `.xlsx` 扩展名

### 4. 提取数据
- 点击"开始提取"按钮执行数据提取
- 可选择"追加模式"以避免覆盖现有数据
- **自动去重**：系统会自动过滤重复的店铺信息

### 5. 启用监控（推荐）
- 点击"开启监控"按钮启动文件监控
- 当Fiddler采集到新数据时，会自动提取并保存
- 实现**实时数据采集和处理**的完整工作流
- 点击"停止监控"可以停止监控

### 6. 主题切换（可选）
- 在界面右上角选择喜欢的主题方案
- 支持16种不同风格的背景主题
- 主题选择会自动保存

## 数据格式支持

### JSON 格式示例
```json
{
  "msg": "成功",
  "code": 0,
  "data": {
    "id": -100,
    "name": "红星面馆(牛肉面，热干面)",
    "call_center": "18827288411",
    "address": "湖北省宜昌市夷陵区小溪塔街道峡洲路10号-13",
    "shipping_time": "06:00-13:00",
    "shipping_fee": 5.1,
    "min_price": 20.0,
    "wm_poi_score": 0.0,
    "avg_delivery_time": 33,
    "comment_num": 0
  }
}
```

## 提取字段说明

应用会自动提取以下店铺信息字段（共27个核心字段）：

### 基本信息字段
| 字段名称 | 描述 | 数据来源 |
|---------|------|----------|
| 提取时间 | 数据提取的时间戳 | 自动生成 |
| 店铺名称 | 店铺的名称 | data.name |
| 联系电话 | 店铺联系电话 | data.call_center |
| 电话列表 | 所有联系电话 | data.phone_list |
| 店铺地址 | 店铺详细地址 | data.address |
| 店铺图片 | 店铺图片URL | data.pic_url |

### 营业信息字段
| 字段名称 | 描述 | 数据来源 |
|---------|------|----------|
| 营业时间 | 店铺营业时间 | data.shipping_time |
| 配送费 | 配送费用 | data.shipping_fee |
| 起送价 | 最低起送金额 | data.min_price |
| 配送费提示 | 配送费说明 | data.shipping_fee_tip |
| 起送价提示 | 起送价说明 | data.min_price_tip |
| 配送时间提示 | 配送时间说明 | data.delivery_time_tip |

### 评价数据字段
| 字段名称 | 描述 | 数据来源 |
|---------|------|----------|
| 店铺评分 | 店铺综合评分 | data.wm_poi_score |
| 食品评分 | 食品质量评分 | data.food_score |
| 配送评分 | 配送服务评分 | data.delivery_score |
| 及时送达率 | 准时送达百分比 | data.in_time_delivery_percent |
| 平均接单时间 | 平均接单时长 | data.avg_accept_order_time |
| 平均配送时间 | 平均配送时长（分钟） | data.avg_delivery_time |
| 评论数量 | 用户评论总数 | data.comment_num |

### 销售与服务信息
| 字段名称 | 描述 | 数据来源 |
|---------|------|----------|
| 月销量 | 月度销售数量 | data.month_sale_num |
| 品牌类型 | 品牌分类 | data.brand_type |
| 配送类型 | 配送方式 | data.delivery_type |
| 店铺状态 | 营业状态 | data.poi_sell_status |
| 支持支付 | 支付方式支持 | data.support_pay |
| 支持发票 | 发票服务支持 | data.invoice_support |
| 优惠信息 | 当前优惠活动 | data.discounts2 |

**注意**：为提升数据质量，已移除店铺ID、店铺公告、纬度、经度、距离等5个冗余字段。

## 🌟 特色功能详解

### 🎨 多主题系统
应用提供16种精美的背景主题，满足不同用户的视觉偏好：

| 主题类别 | 主题名称 | 特色描述 |
|---------|---------|----------|
| **清新系列** | 清新蓝灰、清淡绿色、清新薄荷 | 淡雅舒适，适合长时间使用 |
| **商务系列** | 商务蓝、优雅灰色、纯色简约 | 专业简洁，适合办公环境 |
| **自然系列** | 森林绿、海洋蓝、天空蓝 | 自然清新，缓解视觉疲劳 |
| **温暖系列** | 温暖米色、暖阳黄、玫瑰金 | 温馨舒适，营造温暖氛围 |
| **特色系列** | 深色主题、日落橙、淡雅紫色 | 个性鲜明，满足特殊需求 |

### 🔧 固定路径模式
- **简化操作**：无需每次手动选择文件，提升工作效率
- **标准化管理**：统一的数据源位置，便于团队协作
- **减少错误**：避免文件路径选择错误导致的问题
- **快速启动**：应用启动即可直接使用，无需额外配置

### 📱 定制化界面
- **固定尺寸**：1100x1100像素窗口，专为呈尚策划客服部工作环境优化
- **紧凑布局**：最大化信息显示密度，减少滚动操作
- **状态反馈**：实时显示操作状态、监控状态和处理进度
- **日志系统**：详细记录所有操作，便于问题追踪和分析

### 🔗 Fiddler集成
- **自动脚本**：提供完整的Fiddler自动化脚本代码
- **实时采集**：配合文件监控实现数据采集到处理的全自动化
- **目标精准**：专门针对美团外卖店铺信息API进行优化
- **无缝对接**：采集的数据直接保存到应用的固定路径
- **工作流优化**：Fiddler抓包 → 自动保存 → 实时监控 → 智能去重 → Excel导出

## 去重功能说明

### 🔄 智能去重机制
- **去重标准**：基于店铺名称 + 店铺地址的组合进行去重
- **双重保护**：在Python后端和前端界面都实现去重逻辑
- **统计反馈**：显示检测到的重复数据数量和过滤结果

### 📊 去重工作流程
1. **数据提取时**：自动检测重复店铺信息
2. **Excel保存时**：在追加模式下避免重复录入
3. **界面显示时**：过滤重复数据，保持界面简洁
4. **日志记录**：详细记录去重操作和统计信息

### ⚡ 去重优势
- **提升数据质量**：确保Excel文件中无重复记录
- **节省存储空间**：减少冗余数据占用
- **提高分析效率**：为后续数据分析提供清洁数据
- **用户友好**：自动化处理，无需手动干预

## 故障排除

### 常见问题

1. **Python 未找到错误**
   - 确保已安装 Python 3.7+
   - 确保 Python 已添加到系统 PATH

2. **依赖包缺失**
   ```bash
   pip install pandas openpyxl
   ```

3. **文件权限错误**
   - 确保对 `D:\ailun\` 目录有读取权限
   - 确保对输出目录有写入权限

4. **JSON 解析错误**
   - 检查输入文件是否为有效的 JSON 格式
   - 确保文件编码为 UTF-8

5. **数据源文件不存在**
   - 确保文件位于 `D:\ailun\dianpuxinxi.txt`
   - 检查文件路径和文件名是否正确

6. **Fiddler抓包问题**
   - 确保Fiddler已正确配置HTTPS解密
   - 检查自动脚本是否正确添加到 `OnBeforeResponse` 函数
   - 验证目标URL是否匹配：`https://wx.waimai.meituan.com/weapp/v1/poi/info?`
   - 确保 `D:\ailun\` 目录存在且有写入权限

7. **数据采集不完整**
   - 检查网络连接是否稳定
   - 确认微信小程序中正常访问店铺页面
   - 验证Fiddler是否正在运行并捕获流量

### 日志查看
应用内置了详细的日志系统，可以在界面底部的"操作日志"区域查看：
- 蓝色：信息日志
- 绿色：成功操作
- 橙色：警告信息
- 红色：错误信息

## 技术架构

### 前端技术栈
- **Electron 28.0.0**: 跨平台桌面应用框架
- **HTML5**: 页面结构和语义化标记
- **CSS3**: 现代化样式设计（包含16种主题方案）
- **JavaScript (ES6+)**: 交互逻辑和 IPC 通信
- **Font Awesome 6.0.0**: 图标库

### 后端技术栈
- **Python 3.7+**: 数据提取和处理引擎
- **pandas**: 数据分析、操作和去重处理
- **openpyxl**: Excel 文件读写
- **Node.js 16+**: 运行时环境

### 数据采集工具
- **Fiddler Classic**: HTTP/HTTPS抓包工具
- **自动脚本**: 基于JScript.NET的自动化数据保存
- **目标API**: 美团外卖店铺信息接口
- **数据格式**: JSON格式的店铺详细信息

### 核心模块
- **main.js**: Electron 主进程，处理窗口管理和 IPC
- **renderer.js**: 渲染进程，处理用户界面交互和前端去重
- **shop_extractor.py**: Python 数据提取模块，包含后端去重逻辑
- **chokidar**: 文件监控库
- **background_themes.css**: 16种主题方案样式

## 开发说明

### 项目结构
```
shop-info-extractor/
├── main.js                 # Electron 主进程
├── package.json            # 项目配置
├── shop_extractor.py       # Python 数据提取模块（含去重逻辑）
├── background_themes.css   # 16种主题方案样式
├── start.bat              # Windows 启动脚本
├── build.bat              # 构建脚本
├── renderer/               # 渲染进程文件
│   ├── index.html         # 主界面（1100x1100固定窗口）
│   ├── styles.css         # 主样式文件
│   └── renderer.js        # 前端逻辑（含前端去重）
├── assets/                # 资源文件
├── test_deduplication.py  # 去重功能测试脚本
├── fiddler_script.js      # Fiddler自动脚本代码
├── 使用说明.md            # 详细使用指南
├── 项目总结.md            # 项目架构总结
├── 固定路径功能说明.md    # 固定路径功能说明
├── 字段移除总结.md        # 字段优化说明
├── 去重功能实现说明.md    # 去重功能详细说明
└── README.md              # 项目文档
```

### 添加新的数据格式支持
1. 在 `shop_extractor.py` 中添加新的解析方法
2. 更新 `extract_from_text_file` 方法以支持新格式
3. 测试新格式的数据提取功能

## 许可证

MIT License - 详见 LICENSE 文件

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 更新日志

### v1.2.0 (当前版本)
- ✅ **新增智能去重功能**：自动识别并过滤重复店铺信息
- ✅ **Fiddler集成支持**：提供完整的抓包脚本和使用指南
- ✅ **实时数据采集**：Fiddler + 监控功能实现自动化数据流
- ✅ **固定路径模式**：数据源路径固定为 `D:\ailun\dianpuxinxi.txt`
- ✅ **16种主题方案**：支持多种背景主题切换
- ✅ **字段优化**：移除5个冗余字段，保留27个核心字段
- ✅ **界面定制**：1100x1100固定窗口，专为呈尚策划客服部定制
- ✅ **安全增强**：禁用开发者工具和默认菜单栏

### v1.1.0
- ✅ 优化数据提取算法
- ✅ 改进用户界面体验
- ✅ 增强错误处理机制
- ✅ 添加详细日志系统

### v1.0.0
- ✅ 初始版本发布
- ✅ 支持 JSON 格式店铺信息提取
- ✅ 实现 Excel 导出功能
- ✅ 添加文件监控功能
- ✅ 完成现代化用户界面

### 计划功能 (v1.3.0)
- 📋 **Fiddler增强**：内置Fiddler配置向导和状态监控
- 📋 **多平台抓包**：支持Charles、Burp Suite等其他抓包工具
- 📋 **智能过滤**：基于店铺类型、评分等条件的智能数据过滤
- 📋 **批量处理**：支持多个数据源文件的批量处理
- 📋 **数据分析**：内置数据统计和可视化分析面板
- 📋 **格式扩展**：支持CSV、XML、PDF、Word等多种导出格式
- 📋 **API集成**：直接对接美团外卖API（需要官方授权）
